# Mapping
マッピングとは、文書とその文書に含まれるフィールドをどのように保存し、インデックスを作成するかを定義するプロセスである。

各文書はフィールドの集合体であり、それぞれが独自のデータ型を持っています。データをマッピングする際には、そのドキュメントに関連するフィールドのリストを含むマッピング定義を作成します。マッピング定義には、_source フィールドのようなメタデータフィールドも含まれ、ドキュメントに関連するメタデータの処理方法をカスタマイズすることができます。

データを定義するには、ダイナミックマッピングと明示的マッピングを使用します。それぞれの方法は、データジャーニーのどの段階にあるかに応じて、異なる利点をもたらします。例えば、デフォルトを使いたくないフィールドを明示的にマッピングしたり、どのフィールドを作成するかをより細かく制御することができます。そして、Elasticsearchに他のフィールドを動的に追加させることができます。

7.0.0以前はマッピング定義に型名が含まれていましたが、7.0.0からは型名が含まれなくなりました。Elasticsearch 7.0.0以降では、デフォルトのマッピングを受け入れなくなりました。マッピングタイプの削除を参照してください。

Experiment with mapping options
検索リクエストでランタイムフィールドを定義して、さまざまなマッピングオプションを実験したり、検索リクエスト中にマッピングの値を上書きしてインデックスマッピングの値の間違いを修正したりすることができます。

## Dynamic mapping
ダイナミックマッピングを使えば、使い始めたばかりでも、データの実験や探索を行うことができます。Elasticsearchはドキュメントのインデックスを作成するだけで、自動的に新しいフィールドを追加します。トップレベルマッピング、インナーオブジェクトフィールド、ネストされたフィールドにフィールドを追加することができます。

ダイナミックテンプレートを使用すると、マッチング条件に基づいて動的に追加されるフィールドに適用されるカスタムマッピングを定義することができます。

## Explicit mapping
明示的マッピングでは、以下のようなマッピング定義の方法を正確に選択することができます。

- どの文字列フィールドをフルテキストフィールドとして扱うか。
- どのフィールドが数値、日付、ジオロケーションを含むか。
- 日付の値のフォーマット
- 動的に追加されるフィールドのマッピングを制御するためのカスタムルール。

ランタイムフィールドを使用して、再インデックス付けを行わずにスキーマを変更する。実行時フィールドをインデックス付きフィールドと組み合わせて使用することで、 リソースの使用量とパフォーマンスのバランスをとることができます。インデックスは小さくなりますが、検索性能は遅くなります。

## Settings to prevent mapping explosion
インデックスにあまりに多くのフィールドを定義すると、マッピングが爆発的に増加し、メモリ不足のエラーが発生したり、復旧が困難な状況に陥ることがあります。

ダイナミックマッピングのように、新しいドキュメントが挿入されるたびに新しいフィールドが導入されるような状況を考えてみましょう。新しいフィールドはそれぞれインデックス・マッピングに追加されるため、マッピングが大きくなると問題になる可能性があります。

マッピングの制限設定を使用して、フィールドマッピング（手動または動的に作成）の数を制限し、ドキュメントがマッピングの爆発を引き起こすのを防ぎます。
